<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Server Configuration</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="_mysql_database_use.html" title="Chapter&nbsp;81.&nbsp;MySQL Database Use"><link rel="prev" href="_mysql_database_use.html" title="Chapter&nbsp;81.&nbsp;MySQL Database Use"><link rel="next" href="_user_data_import.html" title="User Data Import"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Server Configuration</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_mysql_database_use.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;81.&nbsp;MySQL Database Use</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_user_data_import.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_server_configuration"></a>Server Configuration</h2></div></div></div><p>Now you have to change configuration to load jdbc module instead of XML based repository. Using configuration management script, first change class name handling repository.</p><p>To see current settings run command:</p><pre class="programlisting">$ ./scripts/config.sh -c tigase-config.xml -print -key session_1/user-repo-class</pre><p>As a result you should see something like:</p><pre class="programlisting">session_1/user-repo-class = tigase.db.xml.XMLRepository</pre><p>You can see that current setting points to XML repository implementation. To use jdbc module for connection to MySQL database you have to set tigase.db.jdbc.JDBCRepository class (enter text below in one line):</p><pre class="programlisting">$ ./scripts/config.sh -c tigase-config.xml -print
      -key session_1/user-repo-class -value tigase.db.jdbc.JDBCRepository -set</pre><p>As a result you will see new value set for the parameter:</p><pre class="programlisting">session_1/user-repo-class = tigase.db.jdbc.JDBCRepository</pre><p>You have also to set the same value as authorization repository unless you want to use different authorization data source:</p><pre class="programlisting"> $ ./scripts/config.sh -c tigase-config.xml -print
      -key session_1/auth-repo-class -value tigase.db.jdbc.JDBCRepository -set</pre><p>And again as a result we can see:</p><pre class="programlisting">session_1/auth-repo-class = tigase.db.jdbc.JDBCRepository</pre><p>Next step is to set database connection string. Assuming you have database: <span class="strong"><strong>tigase</strong></span> on <span class="strong"><strong>localhost</strong></span> with database user: <span class="strong"><strong>dbuser</strong></span> and password <span class="strong"><strong>dbpass</strong></span> your connection string will look like this:</p><pre class="programlisting">jdbc:mysql://localhost/tigase?user=dbuser&amp;password=dbpass</pre><p>To set this in your configuration file you have to call again configuration management script 2 times. First for user data repository and second for authorization data repository:</p><pre class="programlisting">$ ./scripts/config.sh -c tigase-config.xml -print -key session_1/user-repo-url
       -value "jdbc:mysql://localhost/tigase?user=dbuser&amp;password=dbpass" -set
$ ./scripts/config.sh -c tigase-config.xml -print -key session_1/auth-repo-url
       -value "jdbc:mysql://localhost/tigase?user=dbuser&amp;password=dbpass" -set</pre><p>Note quotes around connection string. They are needed to make sure shell won&#8217;t interpret special characters.</p><p>Now your configuration is ready to load jdbc module and connect to your database.</p><p>One more thing you need to do is to tell JVM which jdbc driver to use to connect to database. Depending on your MySQL and jdbc installation it might be: com.mysql.jdbc.Driver. To set is as database driver you have to set is a jdbc.drivers property value. Usually you do this by adding -D parameter to Java call:</p><pre class="programlisting"> $ java -Djdbc.drivers=com.mysql.jdbc.Driver tigase.server.XMPPServer</pre><p>If you use tigase.sh script to run server you have to add -Djdbc.drivers=com.mysql.jdbc.Driver to startup script &lt;initProperties,property file&gt;&gt; to JAVA_OPTIONS values.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_mysql_database_use.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="_mysql_database_use.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_user_data_import.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;81.&nbsp;MySQL Database Use&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;User Data Import</td></tr></table></div></body></html>