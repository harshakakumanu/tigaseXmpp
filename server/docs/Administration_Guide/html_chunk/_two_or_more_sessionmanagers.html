<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;27.&nbsp;Two or More SessionManagers</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="index.html" title="Tigase Administration Guide"><link rel="prev" href="_tigase_expected_output.html" title="Tigase - expected output"><link rel="next" href="_database_preparation.html" title="Chapter&nbsp;28.&nbsp;Database Preparation"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;27.&nbsp;Two or More SessionManagers</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_tigase_expected_output.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_database_preparation.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_two_or_more_sessionmanagers"></a>Chapter&nbsp;27.&nbsp;Two or More SessionManagers</h1></div></div></div><p>Artur Hefczyc &lt;<a class="link" href="mailto:artur.hefczyc@tigase.net" target="_top">artur.hefczyc@tigase.net</a>&gt;
v2.0, June 2014: Reformatted for AsciiDoc.
:toc:
:numbered:
:website: <a class="link" href="http://tigase.net" target="_top">http://tigase.net</a>
:Date: 2010-04-06 21:18</p><p>In the most cases you use just one SessionManager object for your Tigase server installation. A single SM can handle multiple virtual domains with separate SSL certificates for each domain.</p><p>Sometimes, however you need very different configuration for each domain. For example you wish to use a separate database for a selected domain or you need a different set of plugins for each domain. For one domain you might want to allow user registration via XMPP and for another you might want to disable this feature.  In such a case you need to load more than one session manager.</p><p>This is generally not a problem. You just need to add another component in the configuration and adjust default settings.</p><p>The question is now how Tigase server knows to which session manager it has to forward packets received from the network. Mind, there is only one component responsible for handling client connections. So it needs to know somehow which session manager is receiver for certain packet.  Of course you set domain names in session manager too. But that is not enough. Tigase server supports cluster mode configuration where session manager can be running on a separate machine. So packet routings rules are not so simple to look at the domain name only. Therefore client connection manager (<span class="strong"><strong>c2s</strong></span>) must know where is located the session manager responsible for handling the packet received from the network.</p><p>To solve the problem <span class="strong"><strong>routings</strong></span> concept has been introduced. You can define packet routings based on the domain name set during XMPP stream initialization.  Each time <span class="strong"><strong>c2s</strong></span> component receives packet from the network it tries to resolve destination component for the packet based on the current routings table. If you look in you server XML configuration file and search for <span class="strong"><strong>c2s</strong></span> configuration section you can find routings node. Default configuration for routings table is quite simple. Just a single regular expression:</p><pre class="programlisting">   &lt;node name="routings"&gt;
    &lt;map&gt;
     &lt;entry key=".+" type="String" value="sess-man%40tigase.org"/&gt;
     &lt;entry key="multi-mode" type="Boolean" value="true"/&gt;
    &lt;/map&gt;
   &lt;/node&gt;</pre><p>As you can see this routings table forwards all packets to a single destination - session manager located on the <span class="strong"><strong>tigase.org</strong></span> server.</p><p>Let&#8217;s say we have now two session managers each of them is responsible for a separate domain.sm1@tigase.org handles requests for <span class="strong"><strong>tigase.org</strong></span> and sm2@tigase.net handles requests for domain <span class="strong"><strong>tigase.net.</strong></span> So let&#8217;s modify our default configuration to properly spread the traffic between these two sessiona managers:</p><pre class="programlisting">   &lt;node name="routings"&gt;
    &lt;map&gt;
     &lt;entry key="tigase.org" type="String" value="sm1%40tigase.org"/&gt;
     &lt;entry key="tigase.net" type="String" value="sm2%40tigase.net"/&gt;
     &lt;entry key="multi-mode" type="Boolean" value="true"/&gt;
    &lt;/map&gt;
   &lt;/node&gt;</pre><p>Please remember that a key is a regular expression in Java style: <a class="link" href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html" target="_top">Pattern.html</a>. You can match more than a single domain with the key, for example: <span class="emphasis"><em>tigase.+</em></span> to match all domains starting with <span class="strong"><strong>tigase</strong></span>. The expression, however won&#8217;t match domain: <span class="strong"><strong>xmpp.tigase.org</strong></span>. To match this domain the expression would need to be: <span class="emphasis"><em>.+tigase.+</em></span>.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_tigase_expected_output.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_database_preparation.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Tigase - expected output&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;28.&nbsp;Database Preparation</td></tr></table></div></body></html>