<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;62.&nbsp;Load Balancing External Components in Cluster Mode</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="index.html" title="Tigase Administration Guide"><link rel="prev" href="_more_components.html" title="More Components"><link rel="next" href="_external_component_and_cluster.html" title="External Component and Cluster"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;62.&nbsp;Load Balancing External Components in Cluster Mode</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_more_components.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_external_component_and_cluster.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_load_balancing_external_components_in_cluster_mode"></a>Chapter&nbsp;62.&nbsp;Load Balancing External Components in Cluster Mode</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="_load_balancing_external_components_in_cluster_mode.html#_load_balancing_external_component">Load Balancing External Component</a></span></dt><dt><span class="section"><a href="_external_component_and_cluster.html">External Component and Cluster</a></span></dt></dl></div><p>Artur Hefczyc &lt;<a class="link" href="mailto:artur.hefczyc@tigase.net" target="_top">artur.hefczyc@tigase.net</a>&gt;
v2.0, June 2014: Reformatted for AsciiDoc.
:toc:
:numbered:
:website: <a class="link" href="http://tigase.net" target="_top">http://tigase.net</a>
:Date: 2011-07-09 22:45</p><p>This document describes how to load balance any external components using Tigase XMPP Server and how to make Tigase&#8217;s components work as external components in a cluster mode.</p><p><span class="emphasis"><em>Please note, all configuration options described here apply to Tigase XMPP Server version 5.1.0 or later.</em></span></p><p>These are actually 2 separate topics:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">One is to distribute load over many instances of a single component to handle larger traffic, or perhaps for high availability.</li><li class="listitem">The second is to make Tigase&#8217;s component work as an external component and make it work in a cluster mode, even if the component itself does not support cluster mode.</li></ol></div><p>Here are step by step instructions and configuration examples teaching how to achieve both goals</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_load_balancing_external_component"></a>Load Balancing External Component</h2></div></div></div><p>The first, simple scenario is to connect multiple instances of an external component to a single Tigase XMPP Server to distribute load.</p><p>Why would you like to do that? There are at least 2 reasons, one would be to spread load over more instances/machines and the second is to improve reliability in case one component fails the other one can take over the work.</p><p>So here is a simple picture showing the use case.</p><p><span class="inlinemediaobject"><img src="./images/ExternalCompClustering002.png" alt="ExternalCompClustering002"></span></p><p>We have a single machine running Tigase XMPP Server and 2 instances of the MUC component connecting to the Tigase. First example configurations.</p><p>The server configuration</p><pre class="programlisting">config-type = --gen-config-def
--user-db = mysql
--admins = admin@devel.tigase.org
--user-db-uri = jdbc:mysql://localhost/db?user=tigase&amp;password=tigase
--virt-hosts = devel.tigase.org

--comp-name-1 = ext
--comp-class-1 = tigase.server.ext.ComponentProtocol
--external = muc.devel.tigase.org:muc-secret:listen:\
       5270:devel.tigase.org:accept:ReceiverBareJidLB</pre><p>And configuration for both instances of the MUC component (identical for both of them):</p><pre class="programlisting">config-type = --gen-config-comp
--user-db = mysql
--admins = admin@devel.tigase.org
--user-db-uri = jdbc:mysql://localhost/db?user=tigase&amp;password=tigase
--virt-hosts = devel.tigase.org

--comp-name-1 = muc
--comp-class-1 = tigase.muc.MUCComponent
--external = muc.devel.tigase.org:muc-secret:connect:\
       5270:devel.tigase.org:accept</pre><p>I guess everything is quite clear and simple to those who are familiar with Tigase&#8217;s configuration except one small element in the Tigase server configuration. At the end of the component connection we have <span class="strong"><strong>ReceiverBareJidLB</strong></span>.</p><p>This is load balancing plugin class. Load balancing plugin decides how the traffic is distributed among different component connections that is different component instances. For the MUC component it does make sense to distribute the traffic based on the receiver bare JID because this is the MUC room address. This way we just distribute MUC rooms and traffic over different MUC component instances.</p><p>This distribution strategy does not always work for all possible components however. For transports for example this would not work at all. A better way to spread load for transports would be based on the source bare JID. And it is possible of course if you use plugin with class name: <span class="strong"><strong>SenderBareJidLB</strong></span>.</p><p>This are two basic load distribution strategies available now. For some use cases none of them is good enough. If you have PubSub, then you probably want to distribute load based on the PubSub node. There is no plugin for that yet but it is easy enough to write one and put the class name in configuration.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_more_components.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_external_component_and_cluster.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">More Components&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;External Component and Cluster</td></tr></table></div></body></html>