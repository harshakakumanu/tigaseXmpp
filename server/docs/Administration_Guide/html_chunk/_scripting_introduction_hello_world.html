<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;2.&nbsp;Scripting Introduction - Hello World!</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="index.html" title="Tigase Administration Guide"><link rel="prev" href="_scripting_support_in_tigase.html" title="Chapter&nbsp;1.&nbsp;Scripting support in Tigase"><link rel="next" href="_executing_script.html" title="Executing Script"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;2.&nbsp;Scripting Introduction - Hello World!</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_scripting_support_in_tigase.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_executing_script.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_scripting_introduction_hello_world"></a>Chapter&nbsp;2.&nbsp;Scripting Introduction - Hello World!</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="_scripting_introduction_hello_world.html#_loading_script_at_run_time">Loading Script at Run Time</a></span></dt><dt><span class="section"><a href="_executing_script.html">Executing Script</a></span></dt><dt><span class="section"><a href="_interaction_in_scripts.html">Interaction in Scripts</a></span></dt><dt><span class="section"><a href="_automatic_scripts_loading_at_startup_time.html">Automatic Scripts Loading at Startup Time</a></span></dt></dl></div><p>Artur Hefczyc &lt;<a class="link" href="mailto:artur.hefczyc@tigase.net" target="_top">artur.hefczyc@tigase.net</a>&gt;
v2.0, June 2014: Reformatted for AsciiDoc.
:toc:
:numbered:
:website: <a class="link" href="http://tigase.net" target="_top">http://tigase.net</a>
:Date: 2010-01-06 20:18</p><p><span class="inlinemediaobject"><img src="./images/tiger3-small.png" alt="tiger3-small"></span></p><p>This document is the first in series describing scripting support in the Tigase server. It shows how to load, install, update and call a script. It contains also an introduction to the scripting API with the first "Hello world!" like example.</p><p>Since the Tigase version 4.3.1 the server supports scripting for administrator commands.</p><p>In theory many different languages can be used to write scripts and the only requirement is that the support <a class="link" href="http://www.jcp.org/en/jsr/detail?id=223" target="_top">JSR-223</a> for the language. More details can be found on the <a class="link" href="https://scripting.dev.java.net/" target="_top">Java scripting project site</a>.</p><p>In practice some languages are better supported than others. At the moment the most recommended is <a class="link" href="http://groovy.codehaus.org/" target="_top">Groovy</a>, although following languages are also confirmed to be working: <a class="link" href="http://www.scala-lang.org/" target="_top">Scala</a>, <a class="link" href="http://www.python.org/" target="_top">Python</a> and <a class="link" href="http://www.ruby-lang.org/en/" target="_top">Ruby</a>. The <a class="link" href="http://projects.tigase.org/server/trac/browser/trunk/src/main" target="_top">Tigase SVN</a> contains a few examples for these languages.</p><p>Please note, the default Tigase installation contains only libraries for Groovy. Adding support for a different language is as simple as copying a few JAR files to the Tigase <span class="strong"><strong>libs/</strong></span> directory.</p><p>All the examples presented in this guide are also available as ready to use scripts in the Tigase SVN repository in directory: <a class="link" href="http://projects.tigase.org/server/trac/browser/trunk/src/main/groovy/tigase/admin" target="_top">src/main/groovy/tigase/admin</a>.</p><p>The scripting utilises only standard XMPP extensions and is by no means specific to any particular solution. I use and prefer Psi client. The whole guide and all the screenshots are created using Psi client. You can, however, use any other client which supports these extensions as well. As the whole thing is based on the service discovery and ad-hoc commands you need an XMPP client with a good support for both features.</p><p>To follow the guide and run all the examples you need installed Tigase server in version at least 4.3.1 and you have to connect to the server as administrator.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_loading_script_at_run_time"></a>Loading Script at Run Time</h2></div></div></div><p>All the scripting stuff is as usually based on the service discovery and ad-hoc commands in the Tigase server.</p><p><span class="inlinemediaobject"><img src="./images/service-disco.png" alt="service-disco"></span></p><p>The first thing to do, therefore, is to browse service discovery on the running server. The result you receive depends on your installation and installed components.</p><p>The most interesting for us right now are all items with "<span class="strong"><strong><a class="link" href="http://jabber.org/protocol/admin" target="_top">http://jabber.org/protocol/admin</a></strong></span>" in their node part. You may have a few scripts loaded already but there are two commands used for scripting management. Their names are descriptive anouth I hope: "<span class="strong"><strong>New command script</strong></span>" and "<span class="strong"><strong>Remove command script</strong></span>".</p><p>The first is for adding a new script or updating existing and the second is for removing script from the server.</p><p>To add a new script you have just to execute "<span class="strong"><strong>New command script</strong></span>". In Psi this is done by double clicking on the element in service discovery list.</p><p><span class="inlinemediaobject"><img src="./images/hello1-new-script.png" alt="hello1-new-script"></span></p><p>The screenshot above shows a couple of options to set for the loaded script:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>Description</strong></span> - is what shows as the script name in the service discovery window. There are no special restrictions on what to put there.</li><li class="listitem"><span class="strong"><strong>Command id</strong></span> - is a unique ID of the script (admin command). This is what shows after the "http://jabber.org/protocol/admin" in node part. This needs to be unique or existing script is overwritten.</li><li class="listitem"><span class="strong"><strong>Language</strong></span> - a drop down list of all supported scripting languages for your installation. The Tigase automatically detects all libraries for scripting languages and lists them here. So all you need is to select correct language for your script.</li><li class="listitem"><span class="strong"><strong>Script text</strong></span> - is just your script content.</li></ul></div><p>When your script is ready and all fields are correctly set, simply press "<span class="strong"><strong>Finish</strong></span>" button and you should receive a message confirming that the script has been loaded successfully.</p><p><span class="inlinemediaobject"><img src="./images/loaded-ok-small.png" alt="loaded-ok-small"></span></p><p>In this guide we are creating a simple script of type "Hello world". The script is written in Groovy. What it does is displaying a window (ad-hoc command result) with a message: "<span class="emphasis"><em>Hello admin, how are you?</em></span>".</p><p>It uses a basic scripting API which is described line by line below:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">It imports basic Tigase classes.</li><li class="listitem">Set&#8217;s a local variable \'p' which points to a \'packet' variable with data received from the client.</li><li class="listitem">Creates a \'res' variable which is response sent back to the client (administrator). The response to the client is of type \'result'. Other possible types will be introduced later.</li><li class="listitem">We operate on ad-hoc commands here so the script uses Tigase utility class to set/retrieve command parameters. It sets the window title and a simple message displayed to the user (administrator).</li><li class="listitem">The last line returns new packet as a script execution result.</li></ol></div><p>The first, very simple version looks like this:</p><pre class="programlisting">import tigase.server.*
def p = (Packet)packet
def res = p.commandResult(Command.DataType.result)
Command.addTitle(res, "Hello World Script")
Command.addInstructions(res, "Hello admin, how are you?")
return res</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_scripting_support_in_tigase.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_executing_script.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;1.&nbsp;Scripting support in Tigase&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Executing Script</td></tr></table></div></body></html>