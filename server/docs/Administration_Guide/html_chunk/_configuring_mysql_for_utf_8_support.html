<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Configuring MySQL for UTF-8 Support</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="_prepare_the_mysql_database_for_the_tigase_server.html" title="Chapter&nbsp;29.&nbsp;Prepare the MySQL Database for the Tigase Server"><link rel="prev" href="_configuring_from_the_linux_shell_command_line.html" title="Configuring From the Linux Shell Command Line"><link rel="next" href="_other_mysql_setting_worth_considering.html" title="Other MySQL Setting Worth Considering"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Configuring MySQL for UTF-8 Support</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_configuring_from_the_linux_shell_command_line.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;29.&nbsp;Prepare the MySQL Database for the Tigase Server</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_other_mysql_setting_worth_considering.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_configuring_mysql_for_utf_8_support"></a>Configuring MySQL for UTF-8 Support</h2></div></div></div><p>In the my.conf put following lines:</p><pre class="programlisting">[mysql]
default-character-SET=utf8

[client]
default-character-SET=utf8

[mysqld]
init_connect='SET collation_connection = utf8_general_ci; SET NAMES utf8;'
character-set-server=utf8
default-character-SET=utf8
collation-server=utf8_general_ci
skip-character-set-client-handshake</pre><p>Then connect to the database and from the command line shell check settings:</p><pre class="programlisting">SHOW VARIABLES LIKE 'character_set_database';
SHOW VARIABLES LIKE 'character_set_client';</pre><p>If any of these shows something else then 'utf8' then you have to correct it:</p><pre class="programlisting">ALTER DATABASE tigasedb DEFAULT CHARACTER SET utf8;</pre><p>You can now also test your database installation if it accepts UTF-8 data. Best way is just to create an account with UTF-8 characters:</p><pre class="programlisting">call TigAddUserPlainPw('&#380;&oacute;&#322;w@some.domain.com', '&#380;&oacute;&#322;w');</pre><p>And then check of the account has been created:</p><pre class="programlisting">SELECT * FROM tig_users WHERE user_id = '&#380;&oacute;&#322;w@some.domain.com';</pre><p>If the last command gives you no results it means there is still something wrong with settings. You might also check you shell settings to make sure your command line shell supports UTF-8 characters and passes them correctly to MySQL:</p><pre class="programlisting">export LANG=en_US.UTF-8
export LOCALE=UTF-8
export LESSCHARSET='utf-8'</pre><p>It seems to me that MySQL 5.0.x also needs an extra parameters in the connection string: '&amp;useUnicode=true&amp;characterEncoding=UTF-8' while MySQL 5.1.x seems to not need it but it doesn&#8217;t hurt to have it for both versions. You have to edit 'etc/init.properties' file and append this to the database connection string.</p><p>For MySQL 5.1.x, however, you need also updated code for all database stored procedures and functions used by the Tigase. They are updated for Tigase version 4.4.x and up, for the time being if you use older version of the Tigase server you can reload stored procedures using the file from SVN.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_configuring_from_the_linux_shell_command_line.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="_prepare_the_mysql_database_for_the_tigase_server.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_other_mysql_setting_worth_considering.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Configuring From the Linux Shell Command Line&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Other MySQL Setting Worth Considering</td></tr></table></div></body></html>