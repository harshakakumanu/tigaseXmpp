<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;44.&nbsp;Server Monitoring</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="index.html" title="Tigase Administration Guide"><link rel="prev" href="_register_own_xmpp_domain.html" title="Chapter&nbsp;43.&nbsp;Register Own XMPP Domain"><link rel="next" href="RetrievingStatisticsFromTheServer.html" title="Retrieving statistics from the server"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;44.&nbsp;Server Monitoring</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_register_own_xmpp_domain.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="RetrievingStatisticsFromTheServer.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_server_monitoring"></a>Chapter&nbsp;44.&nbsp;Server Monitoring</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="_server_monitoring.html#setUpRemoteMonitoring">Setting Up Remote Monitoring in the Server</a></span></dt><dd><dl><dt><span class="section"><a href="_server_monitoring.html#_what_you_need">What You Need.</a></span></dt><dt><span class="section"><a href="_server_monitoring.html#monitoring_activation">Activation</a></span></dt><dt><span class="section"><a href="_server_monitoring.html#_security_2">Security</a></span></dt><dt><span class="section"><a href="_server_monitoring.html#_snmp">SNMP</a></span></dt></dl></dd><dt><span class="section"><a href="RetrievingStatisticsFromTheServer.html">Retrieving statistics from the server</a></span></dt><dd><dl><dt><span class="section"><a href="RetrievingStatisticsFromTheServer.html#_retrieving_statistics_using_xmpp">Retrieving statistics using XMPP</a></span></dt><dt><span class="section"><a href="RetrievingStatisticsFromTheServer.html#_retrieving_statistics_using_jmx">Retrieving statistics using JMX</a></span></dt></dl></dd></dl></div><p>All the documentation and resources related to the Tigase server monitoring.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setUpRemoteMonitoring"></a>Setting Up Remote Monitoring in the Server</h2></div></div></div><p>The Tigase server can be remotely monitored over following protocols: <span class="strong"><strong>JMX/RMI</strong></span>, <span class="strong"><strong>SNMP</strong></span> and <span class="strong"><strong>HTTP</strong></span>. Even though JMX offers the biggest control and visibility to the server states all of the monitoring services give the same basic set of the server statistics:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Number of network connections for s2s, c2s and Bosh</li><li class="listitem">Last second, last minute and last hour load for all main components: SM, MR, c2s, s2s, Bosh, MUC and PubSub</li><li class="listitem">System statistics - memory usage (heap and non heap) and the server uptime in milliseconds and human readable text.</li><li class="listitem">Users statistics - number of registered users and number of online user session.</li></ul></div><p>JMX/RMI and SNMP servers offer basic security and can restrict access based and the HTTP server doesn&#8217;t offer any access restriction mechanisms. Therefore HTTP monitoring is recommended to work behind a firewall.</p><p>The monitoring itself causes very low overhead in terms of the resources and CPU consumption on top of the normal Tigase processing requirements so it can be left always on without worrying about performance degradation.</p><p><span class="strong"><strong>Note.</strong></span> <span class="emphasis"><em>This works with the Tigase server from version</em></span> <span class="strong"><strong>4.2.0</strong></span> <span class="emphasis"><em>or SVN revision</em></span> <span class="strong"><strong>1418</strong></span>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_what_you_need"></a>What You Need.</h3></div></div></div><p>If you use binary build for version 4.2.0 or later you can skip this section as all required libraries are included in the installation package: Extras pack. Please install the pack and you don&#8217;t have to worry about libraries any more.</p><p>If you run the server from sources or SVN continue reading:</p><p>The remote monitoring requires an external library therefore it is implemented in the tigase-extras package to comply with the basic rule - no third-party libraries are needed for the core Tigase server. But still what you need for the remote monitoring activation is just 2 jar files:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><a class="link" href="http://www.tigase.org/project/extras" target="_top">tigase-extras</a> the last <a class="link" href="http://maven.tigase.org/tigase/tigase-extras/0.3.0-SNAPSHOT/tigase-extras-0.3.0-20090110.223424-2.jar" target="_top">0.3.0-SNAPSHOT</a> or later</li><li class="listitem"><span class="strong"><strong>jdmkrt.jar</strong></span> file from <a class="link" href="https://opendmk.dev.java.net/" target="_top">OpenDMK</a> project version 5.1 or later. A copy of this jar file in also available in our maven repository: <a class="link" href="http://maven.tigase.org/openDMK/jdmkrt/1.0-b02/jdmkrt-1.0-b02.jar" target="_top">jdmkrt.jar</a>.</li></ol></div><p>Download both libraries and put them in the libs/ directory.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring_activation"></a>Activation</h3></div></div></div><p>You can either run the Tigase installer and use configuration wizard to activate the monitoring or edit etc/init.properties file and add following line:</p><pre class="programlisting">--monitoring=jmx:9050,http:9080,snmp:9060</pre><p>As you see there is only a single line where you put list of monitoring servers you want to activate. Each server is responsible for activation of a different protocol and takes a single parameter - port number. There are following protocols supported right now:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="strong"><strong>jmx</strong></span> - activating monitoring via JMX/RMI</li><li class="listitem"><span class="strong"><strong>http</strong></span> - activating monitoring over HTTP protocol</li><li class="listitem"><span class="strong"><strong>snmp</strong></span> - activating monitoring over SNMP protocol</li></ul></div><p>You can have all protocols active at the same time or any combination of them or none.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_security_2"></a>Security</h3></div></div></div><p>Both JMX and SNMP offer security protection to limit access to monitoring data. The security configuration is a bit different for both.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="monitoring_jmx"></a>JMX</h4></div></div></div><p>After the server installation or in the SVN repository you can find 2 files in the <span class="strong"><strong>etc/</strong></span> directory: <span class="strong"><strong>jmx.access</strong></span> and <span class="strong"><strong>jmx.password</strong></span>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara"><span class="strong"><strong>jmx.access</strong></span> is a user permission file. You can use it to specify whether the user can access the monitoring data for reading only 'readonly' or with read-write 'readwrite' access. There are example entries in the file already and the content may simply look like:</p><pre class="programlisting">monitor readonly
admin readwrite</pre></li><li class="listitem"><p class="simpara"><span class="strong"><strong>jmx.password</strong></span> is a user password file. You can set user passwords here and the format again is very simple and the same as for jmx.access. There are example entries already provided for you convenience. Content of the file may look like the example below:</p><pre class="programlisting">admin admin_pass
monitor monitor_pass</pre></li></ul></div><p>Using above to files you can control who and how can access the JMX monitoring services.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_snmp"></a>SNMP</h3></div></div></div><p>Access to the SNMP monitoring is controlled using ACL (access control lists) which can be configured in the file  <span class="strong"><strong>snmp.acl</strong></span> located in <span class="strong"><strong>etc/</strong></span> directory. It contains lots of detailed instructions how to setup ACL and restrict access per user, host and what kind access is allowed. The simplest possible configuration may look like this:</p><pre class="programlisting">acl = {
  {
    communities = public, private
    access = read-only
    managers = public.host.com, private.host.com
  }
  {
    communities = admin
    access = read-write
    managers = localhost, admin.host.com
  }
}</pre><p>You might also need Tigase MIB definition: <a class="link" href="https://svn.tigase.org/reps/tigase-extras/trunk/src/main/resources/mib/TIGASE-MANAGEMENT-MIB.mib" target="_top">TIGASE-MANAGEMENT-MIB.mib</a> for the server specific statistics. The MIB contains definition for all the server statistics exposed via SNMP.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_register_own_xmpp_domain.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="RetrievingStatisticsFromTheServer.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;43.&nbsp;Register Own XMPP Domain&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Retrieving statistics from the server</td></tr></table></div></body></html>