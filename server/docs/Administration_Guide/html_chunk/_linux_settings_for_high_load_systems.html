<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;14.&nbsp;Linux Settings for High Load Systems</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="index.html" title="Tigase Administration Guide"><link rel="prev" href="_basic_system_checks.html" title="Chapter&nbsp;13.&nbsp;Basic System Checks"><link rel="next" href="_net_ipv4_ip_local_port_range.html" title="net.ipv4.ip_local_port_range"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;14.&nbsp;Linux Settings for High Load Systems</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_basic_system_checks.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_net_ipv4_ip_local_port_range.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_linux_settings_for_high_load_systems"></a>Chapter&nbsp;14.&nbsp;Linux Settings for High Load Systems</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="_linux_settings_for_high_load_systems.html#_fs_file_max">fs.file-max</a></span></dt><dt><span class="section"><a href="_net_ipv4_ip_local_port_range.html">net.ipv4.ip_local_port_range</a></span></dt><dt><span class="section"><a href="_tcp_keepalive.html">TCP_keepalive</a></span></dt><dt><span class="section"><a href="__etc_sysctl_conf.html">/etc/sysctl.conf</a></span></dt><dt><span class="section"><a href="_nofile.html">nofile</a></span></dt><dt><span class="section"><a href="_su_and_init_script.html">su and init script</a></span></dt></dl></div><p>Artur Hefczyc &lt;<a class="link" href="mailto:artur.hefczyc@tigase.net" target="_top">artur.hefczyc@tigase.net</a>&gt;
v2.0, June 2014: Reformatted for AsciiDoc.
:toc:
:numbered:
:website: <a class="link" href="http://tigase.net" target="_top">http://tigase.net</a>
:Date: 2010-04-06 21:18</p><p>There are a few basic settings you have to adjust for high load systems to make sure the server have enough resources to handle big number of network connections.</p><p>The main parameter is a maximum number of opened files allowed for the process to keep at the same time. Each network connection uses a file handler therefore if the limit is too low you can quickly run out of handlers and the server can not accept any more connections.</p><p>This limit is set on 2 levels - on the kernel level (<span class="strong"><strong>fs.file-max</strong></span>) and on the system level (<span class="strong"><strong>nofile</strong></span>).</p><p>Another kernel property which can be important in certain configurations (like transports installations or when you use proxy for Bosh connections) is: <span class="strong"><strong>net.ipv4.ip_local_port_range</strong></span>. This parameter can be set the same way as the fs.file-max property.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_fs_file_max"></a>fs.file-max</h2></div></div></div><p>The <span class="strong"><strong>fs.file-max</strong></span> kernel property is set via sysctl command. You can see current settings executing command:</p><pre class="programlisting"># sysctl fs.file-max
fs.file-max = 358920</pre><p>If you plan to run high load service with big number of server connections then this parameter should be at least as twice big as the number of network connections you expect to support. You can change this setting executing command:</p><pre class="programlisting"># sysctl -w fs.file-max=360000
fs.file-max = 360000</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_basic_system_checks.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_net_ipv4_ip_local_port_range.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;13.&nbsp;Basic System Checks&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;net.ipv4.ip_local_port_range</td></tr></table></div></body></html>