<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;34.&nbsp;Tigase Database Minor but Useful Schema Change in Version 5.1.0</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="index.html" title="Tigase Administration Guide"><link rel="prev" href="_prepare_the_postgresql_database_for_the_tigase_server.html" title="Chapter&nbsp;33.&nbsp;Prepare the PostgreSQL Database for the Tigase Server"><link rel="next" href="_tigase_load_balancing.html" title="Chapter&nbsp;35.&nbsp;Tigase Load Balancing"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;34.&nbsp;Tigase Database Minor but Useful Schema Change in Version 5.1.0</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_prepare_the_postgresql_database_for_the_tigase_server.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_tigase_load_balancing.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_tigase_database_minor_but_useful_schema_change_in_version_5_1_0"></a>Chapter&nbsp;34.&nbsp;Tigase Database Minor but Useful Schema Change in Version 5.1.0</h1></div></div></div><p>Artur Hefczyc &lt;<a class="link" href="mailto:artur.hefczyc@tigase.net" target="_top">artur.hefczyc@tigase.net</a>&gt;
v2.0, June 2014: Reformatted for AsciiDoc.
:toc:
:numbered:
:website: <a class="link" href="http://tigase.net" target="_top">http://tigase.net</a>
:Date: 2012-06-05 02:38</p><p>We have recently made a simple but very useful change to the DB schema in Tigase. It does preserve backward compatibility and it is not required to change your existing schema, even if you upgrade your installation to the most recent 5.1.0 version.</p><p>However, the change is very useful to track new accounts creation, therefore this article shows how to make modifications to you schema manually.</p><p>The change is related to adding a new field: acc_create_time which stores exact time of user account creation. The time is recorded automatically by database when a new record in the user table is created. So there is no extra overhead or resource usage on the Tigase server.</p><p>While the new field was added I have also slightly modifies types of 2 other fields: last_login and last_logout.</p><p>Here is how it looks now:</p><pre class="programlisting">-- Time the account has been created
acc_create_time timestamp DEFAULT CURRENT_TIMESTAMP,
-- Time of the last user login
last_login timestamp DEFAULT 0,
-- Time of the last user logout
last_logout timestamp DEFAULT 0,</pre><p>You can easily update your schema with above changes using a simple SQL query. Enter the MySQL shell and copy-paste following query:</p><pre class="programlisting">alter table tig_users
  modify last_login timestamp DEFAULT 0,
  modify last_logout timestamp DEFAULT 0,
  add acc_create_time timestamp DEFAULT CURRENT_TIMESTAMP;</pre><p>Please note, after executing query above the column acc_create_time will have meaningless value. To put some meaning for existing records I just copy last_login value to acc_create_time:</p><pre class="programlisting">update tig_users set acc_create_time = last_login;</pre></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_prepare_the_postgresql_database_for_the_tigase_server.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_tigase_load_balancing.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;33.&nbsp;Prepare the PostgreSQL Database for the Tigase Server&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;35.&nbsp;Tigase Load Balancing</td></tr></table></div></body></html>