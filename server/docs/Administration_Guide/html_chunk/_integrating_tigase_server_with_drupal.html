<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;74.&nbsp;Integrating Tigase Server with Drupal</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="index.html" title="Tigase Administration Guide"><link rel="prev" href="_connecting_the_tigase_server_to_mysql_database.html" title="Chapter&nbsp;73.&nbsp;Connecting the Tigase Server to MySQL Database"><link rel="next" href="_integrating_tigase_server_with_libresource.html" title="Chapter&nbsp;75.&nbsp;Integrating Tigase Server With LibreSource"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;74.&nbsp;Integrating Tigase Server with Drupal</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_connecting_the_tigase_server_to_mysql_database.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_integrating_tigase_server_with_libresource.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_integrating_tigase_server_with_drupal"></a>Chapter&nbsp;74.&nbsp;Integrating Tigase Server with Drupal</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="_integrating_tigase_server_with_drupal.html#_connecting_to_drupal_database">Connecting to Drupal Database</a></span></dt></dl></div><p>Artur Hefczyc &lt;<a class="link" href="mailto:artur.hefczyc@tigase.net" target="_top">artur.hefczyc@tigase.net</a>&gt;
v2.0, June 2014: Reformatted for AsciiDoc.
:toc:
:numbered:
:website: <a class="link" href="http://tigase.net" target="_top">http://tigase.net</a>
:Date: 2010-04-06 21:16</p><p>Tigase supports integration with Drupal on many levels. At the moment all stuff described below work with Drupal version 4.x and 5.x. They may also work with Drupal 6.x but this version hasn&#8217;t been tested.</p><p>First of all it can authenticate users against Drupal database which means you have the same user account for both Drupal website and XMPP (Jabber) server. More over in such a configuration all account management is done via Drupal web interface like account creation, password change update user details and so on. Administrator can temporarily disable user account and this is respected by the Tigase server too.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_connecting_to_drupal_database"></a>Connecting to Drupal Database</h2></div></div></div><p>The best way to setup Tigase with Drupal database is via configuration wizards that is init.properties file where you can put initial setting for Tigase configuration.</p><p>If you look in etc/ directory of your Tigase installation you should find a few files there. The one we want to base our configuration on is: init-mysql.properties. In some older packages the file might be missing, then you can download it from the <a class="link" href="https://svn.tigase.org/reps/tigase-server/trunk/etc/init-mysql.properties" target="_top">SVN repository</a>.</p><p>If you look inside the file and strip all the comments you would see following lines:</p><pre class="programlisting">config-type=--gen-config-def
--admins=admin@tigase.org,admin@tigase.net
--user-db=mysql
--user-db-uri=jdbc:mysql://localhost/tigasedb?user=tigase_user&amp;password=mypass
--virt-hosts=tigase.org,tigase.net
--debug=server</pre><p>All you need to connect to Drupal database are 2 following lines:</p><pre class="programlisting">--auth-db=drupal
--auth-db-uri=jdbc:mysql://localhost/drupal?user=drupalusr&amp;password=drupalpass</pre><p>Let&#8217;s combine it in a single file called etc/init-drupal.properties:</p><pre class="programlisting">config-type=--gen-config-def
--admins=admin@tigase.org,admin@tigase.net
--auth-db=drupal
--auth-db-uri=jdbc:mysql://localhost/drupal?user=drupalusr&amp;password=drupalpass
--user-db=mysql
--user-db-uri=jdbc:mysql://localhost/tigasedb?user=tigase_user&amp;password=mypass
--virt-hosts=tigase.org,tigase.net
--debug=server</pre><p>In theory you can load Tigase database schema to Drupal database and then both db-uris would have the same database connection string. More details about setting up and connecting to MySQL database can be found in the ////&lt;&lt;prepareMysql,//// MySQL guide.</p><p>You need also to edit etc/tigase.conf file to point to your newly created properties file. The last line which looks like this:</p><pre class="programlisting">TIGASE_OPTIONS=" --property-file etc/init.properties "</pre><p>should be changed to following:</p><pre class="programlisting">TIGASE_OPTIONS=" --property-file etc/init-drupal.properties "</pre><p>Make sure you have Java-6 installed and JAVA_HOME is set to correct location. If JAVA_HOME is not set you can add following line to etc/tigase.conf file:</p><pre class="programlisting">JAVA_HOME="/your/java-6-location"</pre><p>The best way to check whether the variable is set correctly is with command:</p><pre class="programlisting">$ ls -l $JAVA_HOME/bin/java</pre><p>should list you the file without error.</p><p>Check also if logs/ directory is created in your Tigase server location as sometimes unpacking application doesn&#8217;t create empty directories.</p><p>Now when you have the configuration file and databases ready to use you can start the Tigase server with the following command:</p><pre class="programlisting">./bin/tigase.sh start etc/tigase.conf</pre><p>If you run the Tigase server installed from sources the command would be:</p><pre class="programlisting">./scripts/tigase.sh start etc/tigase.conf</pre><p>There are system startup scripts for Gentoo and Mandriva Linux on bin/ or scripts/ directory which can be used to automatically start the server when system starts.</p><p>Now you can register an account on your Drupal website and connect with Jabber client using the account details.</p><p><span class="strong"><strong>Note!</strong></span> <span class="emphasis"><em>You have to enable plain password authentication in your Jabber client to connect to the Tigase server with Drupal database</em></span></p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_connecting_the_tigase_server_to_mysql_database.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_integrating_tigase_server_with_libresource.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;73.&nbsp;Connecting the Tigase Server to MySQL Database&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;75.&nbsp;Integrating Tigase Server With LibreSource</td></tr></table></div></body></html>