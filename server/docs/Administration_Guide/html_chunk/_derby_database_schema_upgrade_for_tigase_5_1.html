<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;48.&nbsp;Derby Database Schema Upgrade for Tigase 5.1</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="index.html" title="Tigase Administration Guide"><link rel="prev" href="_tigase_5_1_database_schema_upgrade.html" title="Chapter&nbsp;47.&nbsp;Tigase 5.1 Database Schema Upgrade"><link rel="next" href="_mysql_database_schema_upgrade_for_tigase_5_1.html" title="Chapter&nbsp;49.&nbsp;MySQL Database Schema Upgrade for Tigase 5.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;48.&nbsp;Derby Database Schema Upgrade for Tigase 5.1</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_tigase_5_1_database_schema_upgrade.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_mysql_database_schema_upgrade_for_tigase_5_1.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_derby_database_schema_upgrade_for_tigase_5_1"></a>Chapter&nbsp;48.&nbsp;Derby Database Schema Upgrade for Tigase 5.1</h1></div></div></div><p>Wojciech Kapcia &lt;<a class="link" href="mailto:wojciech.kapcia@tigase.org" target="_top">wojciech.kapcia@tigase.org</a>&gt;
v2.0, June 2014: Reformatted for AsciiDoc.
:toc:
:numbered:
:website: <a class="link" href="http://tigase.net" target="_top">http://tigase.net</a>
:Date: 2012-06-20 19:12</p><p>Unfortunately we had to make a small change to the database schema for 5.1.0 version of the Tigase server.</p><p>The good news is that it does not affect data or data structure, only the way some data is accessed in database. We added one more stored procedure which has to be installed in database if you upgrade your installation from a previous Tigase version.</p><p>Therefore the schema upgrade is very simple and safe but make sure the current database schema is in version 4.0.</p><p>First things first - make a database backup:</p><pre class="programlisting">tar -czf derbyDB.tar.gz /path/to/derbyDB</pre><p>If you need to restore database for any reason simply extract files from the backup archive:</p><pre class="programlisting">rm -rf /path/to/derbyDB
tar -xf derbyDB.tar.gz</pre><p>Now we can run schema upgrade script</p><pre class="programlisting">java -Dij.protocol=jdbc:derby: -Dij.database="/path/to/derbyDB" \
		-Dderby.system.home=`pwd` \
		-cp libs/derby.jar:libs/derbytools.jar:jars/tigase-server.jar \
		org.apache.derby.tools.ij database/postgresql-schema-upgrade-to-5-1.sql</pre></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_tigase_5_1_database_schema_upgrade.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_mysql_database_schema_upgrade_for_tigase_5_1.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;47.&nbsp;Tigase 5.1 Database Schema Upgrade&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;49.&nbsp;MySQL Database Schema Upgrade for Tigase 5.1</td></tr></table></div></body></html>