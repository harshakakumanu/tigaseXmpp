<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Interaction in Scripts</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Administration Guide"><link rel="up" href="_scripting_introduction_hello_world.html" title="Chapter&nbsp;2.&nbsp;Scripting Introduction - Hello World!"><link rel="prev" href="_executing_script.html" title="Executing Script"><link rel="next" href="_automatic_scripts_loading_at_startup_time.html" title="Automatic Scripts Loading at Startup Time"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Interaction in Scripts</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_executing_script.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;2.&nbsp;Scripting Introduction - Hello World!</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_automatic_scripts_loading_at_startup_time.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_interaction_in_scripts"></a>Interaction in Scripts</h2></div></div></div><p>Displaying just a message is very nice but in most cases not very useful. Normally you need to ask the user for some more data or parameters before you can perform any real processing.</p><p>Therefore in most cases the administrator script has to display a new window with input fields asking the user (admin) for some more data. In this document we present very simple examples, just an introduction so let&#8217;s ask about the administrator name before displaying greetings.</p><p><span class="inlinemediaobject"><img src="./images/hello2-asking-for-name-small.png" alt="hello2-asking-for-name-small"></span></p><p>To ask the user for some more information we have to extend example above with some more code:</p><pre class="programlisting">import tigase.server.*

def p = (Packet)packet

def name = Command.getFieldValue(packet, "name")

if (name == null) {
  def res = p.commandResult(Command.DataType.form);
  Command.addTitle(res, "Hello World Script")
  Command.addInstructions(res, "Please provide some details")
  Command.addFieldValue(res, "name", name ?: "", "text-single",
    "Your name")
  return res
}

def res = p.commandResult(Command.DataType.result)
Command.addTitle(res, "Hello World Script")
Command.addInstructions(res, "Hello ${name}, how are you?")

return res</pre><p>If you compare both scripts you see that they are quite similar. Before displaying greeting, however, the script tries to retrieve data from the \'name' input field. If the name had been provided the greeting is displayed, otherwise the script asks for the user name.</p><p><span class="inlinemediaobject"><img src="./images/hello2-result-small.png" alt="hello2-result-small"></span></p><p>Please note, in this case the packet sent back to the user is of type form instead of result. The practical difference is that the type result displays only <span class="strong"><strong>OK</strong></span> button which is pressed doesn&#8217;t send any data to the server. The form packet displays more buttons - <span class="strong"><strong>Finish</strong></span> and <span class="strong"><strong>Cancel</strong></span>. Whichever you press some data are sent back to the server.</p><p>The script demonstrates use of two new methods from the utility class "Command": getFieldValue and addFieldValue.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">The first argument to all Command methods is the packet with ad-hoc command.</li><li class="listitem">The second argument is usually the input field name</li></ul></div><p>These two method parameters are actually enough to read the ad-hoc command data. Methods creating input fields in the ad-hoc command need a few arguments more:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Next arguments sets a default value displayed to the user. The way how it is set in the example above is specific to Groovy language and is quite useful what will be apparent in later examples.</li><li class="listitem">After that we have to specify the field type. All field types are defined in the <a class="link" href="http://xmpp.org/extensions/xep-0004.html#protocol-fieldtypes" target="_top">XEP-0004</a>.</li><li class="listitem">The last argument specifies the field label which is displayed to the user.</li></ul></div><p><span class="inlinemediaobject"><img src="./images/hello2-new-script.png" alt="hello2-new-script"></span></p><p>There are a few other different utility methods in the Command class to set different types of input fields and they will be described in details later on.</p><p>To reload the script simply call "New command script" again, enter the script text and make sure you entered exactly the same command ID to replace the old script with the new one.</p><p>Or, of course you can enter a new command id to create a new command and make it available on your server.</p><p>When the script is loaded on the server, try to execute it. You should get a new dialog window asking for your name as in the screenshot at the beginning of this section. When you entered your name and pressed "Finish" button you see another window and greetings message with your name.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_executing_script.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="_scripting_introduction_hello_world.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_automatic_scripts_loading_at_startup_time.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Executing Script&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Automatic Scripts Loading at Startup Time</td></tr></table></div></body></html>