<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;6.&nbsp;API changes in the Tigase Server 5.x</title><link rel="stylesheet" type="text/css" href="css/docbook-xsl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Tigase Development Guide"><link rel="up" href="index.html" title="Tigase Development Guide"><link rel="prev" href="_project_import.html" title="Project Import"><link rel="next" href="_server_compilation.html" title="Chapter&nbsp;7.&nbsp;Server Compilation"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;6.&nbsp;API changes in the Tigase Server 5.x</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_project_import.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="_server_compilation.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="_api_changes_in_the_tigase_server_5_x"></a>Chapter&nbsp;6.&nbsp;API changes in the Tigase Server 5.x</h1></div></div></div><p>Artur Hefczyc &lt;<a class="link" href="mailto:artur.hefczyc@tigase.net" target="_top">artur.hefczyc@tigase.net</a>&gt;
v2.0, June 2014: Reformatted for AsciiDoc.
:toc:
:numbered:
:website: <a class="link" href="http://tigase.net/" target="_top">http://tigase.net/</a>
:Date: 2010-01-06 20:22</p><p>The API changes can affect you only if you develop own code to run inside the Tigase server. The changes are not extensive but in some circumstances may require many simple changes in a few files.</p><p>All the changes are related to introducing tigase.xmpp.JID and tigase.xmpp.BareJID classes. It is recommended to use them for all operations performed on the user JID instead of the String class which was used before changes.</p><p>There are a few advantages of using the new classes. First of all they do all the user JID checking and parsing, they also perform stringprep processing. Therefore if you use data kept by instance of the JID or BareJID you can be sure they are valid and correct.</p><p>These are not all advantages however. Working with a profiler and optimising the Tigase code I noticed that a lot of CPU power is used by JID parsing code. JIDs and parts of the JIDs are used in many places of the stanza processing and the parsing is performed over and over again in all these places, wasting CPU cycles, memory and time.  Therefore, great benefits from these new class are in performance if once parsed JIDs are reused in all further stanza processing.</p><p>This is where the tigase.server.Packet class comes in handy. Instance of the Packet class encloses XML stanza and pre-parses some, the most commonly used elements of the stanza. Stanza source and destination addresses are among them. As an effect there are all new methods available in the class:</p><pre class="programlisting">JID getStanzaFrom();
JID getStanzaTo();
JID getFrom();
JID getTo();
JID getPacketFrom();
JID getPacketTo();</pre><p>Whereas following methods are still available but have been deprecated:</p><pre class="programlisting">String getElemFrom();
String getElemTo();</pre><p>Please refer to the JavaDoc documentation for the <code class="literal">Packet</code> class and methods to learn all the details of these methods and difference between them.</p><p>Another difference is that you can no longer create the <code class="literal">Packet</code> instance using a constructor. Instead there are a few factory methods available:</p><pre class="programlisting">static Packet packetInstance(Element elem);
static Packet packetInstance(Element elem,
    JID stanzaFrom, JID stanzaTo);</pre><p>Again, please refer to the JavaDoc documentation for all the details. The main point of using these methods is that they actually return an instance of one of the following classes instead of the <code class="literal">Packet</code> class: <code class="literal">Iq</code>, <code class="literal">Presence</code> or <code class="literal">Message</code>.</p><p>There is also a number of utility methods helping with creating a copy of the Packet instance preserving as much pre-parsed data as possible:</p><pre class="programlisting">Packet copyElementOnly();
Packet errorResult(...);
Packet okResult(...);
Packet swapFromTo();
Packet swapStanzaFromTo();</pre><p>Again, I tried to keep the JavaDoc comments as complete as possible, have a look. In case of doubts please contact me and will add missing information to the documentation.</p><p>The main point is to reuse <code class="literal">JID</code> or <code class="literal">BareJID</code> instances in your code as much as possible. You never know, your code may run in highly loaded systems with throughput of 100k XMPP packets per second.</p><p>Another change. This one a bit risky as it is very difficult to find all places where this could be used. There are several utility classes and methods which accept source and destination address of a stanza and produce something.  There was a great confusion with them, as in some of them the first was the source address and in others the destination address. I have re-factored all the code to keep the parameter order the same in all places. Right now the policy is: <span class="strong"><strong>source address first</strong></span>.  Therefore in all places where there was a method:</p><pre class="programlisting">Packet method(String to, String from);</pre><p>it has been changed to:</p><pre class="programlisting">Packet method(JID from, JID to);</pre><p>As far as I know most of these method were used only by myself so I do not expect much trouble for other developers.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_project_import.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="_server_compilation.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Project Import&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;7.&nbsp;Server Compilation</td></tr></table></div></body></html>